<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Empire Ui</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="ui.css">
</head>
<body>
<div class="full"></div>
<script src="../js/jquery.js"></script>
<script>
    $(document).ready(function () {
        let clicked = false;
        let initialPosition = 0;
        let direction;
        $(document).on({
            click: function (e) {
                clicked = !clicked;
                if (clicked && $('#mouseFollow').length === 0){
                    $('<div />', {
                        class: 'mouse-follow',
                        id: 'mouseFollow'
                    }).appendTo($('body'));
                } else {
                    $('#mouseFollow').remove();
                }
                if ($('#mouseFollow').length > 0) {
                    $('#mouseFollow').css({top: e.pageY-25, left: e.pageX-25, width: 50})
                    initialPosition = $('#mouseFollow').position();
                    // console.log($('#mouseFollow').position());
                }
            },
            mousemove: function (e) {
                if (clicked) {
                    let calcWidth,
                        calcRotate = angle(initialPosition.left, initialPosition.top, e.pageX, e.pageY);
                    if (e.pageX - initialPosition.left > 0) {
                        $('#mouseFollow').removeClass('rotate')
                        if (e.pageX - initialPosition.left >= 50) {
                            calcWidth = e.pageX - initialPosition.left;
                        }
                    } else {
                        $('#mouseFollow').addClass('rotate')
                        if (initialPosition.left - e.pageX >= 50) {
                            calcWidth = initialPosition.left - e.pageX;
                        }
                    }
                    $('#mouseFollow').css({
                        'width':  calcWidth+'px',
                        'transform-origin': 'left center',
                        'transform': 'rotate('+calcRotate+'deg)'
                    })
                }
            }
        })

        function angle(cx, cy, ex, ey) {
            var dy = ey - cy;
            var dx = ex - cx;
            var theta = Math.atan2(dy, dx); // range (-PI, PI]
            theta *= 180 / Math.PI; // rads to degs, range (-180, 180]
            //if (theta < 0) theta = 360 + theta; // range [0, 360)
            return theta;
        }
    })
</script>
</body>
</html>
